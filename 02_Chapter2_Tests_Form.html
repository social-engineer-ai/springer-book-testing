<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Regression - Analytics Companion Testing</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
        h1 { color: #1a365d; margin-bottom: 5px; }
        .subtitle { color: #666; margin-bottom: 30px; }
        .chapter-badge { display: inline-block; background: #3182ce; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 20px; }
        .section-divider { background: #ebf8ff; padding: 15px 20px; margin: 30px -40px; font-weight: 600; color: #2c5282; font-size: 18px; }

        .tester-section { background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .tester-section h3 { margin-top: 0; color: #2d3748; }
        .tester-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .tester-row input { padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px; }
        .tester-row input:focus { outline: none; border-color: #3182ce; }

        .test-card { background: #fff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .test-card.critical { border-left: 4px solid #e53e3e; }
        .test-card.important { border-left: 4px solid #ed8936; }
        .test-header { margin-bottom: 15px; }
        .test-id { background: #bee3f8; color: #2b6cb0; padding: 3px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .test-id.critical { background: #fed7d7; color: #c53030; }
        .test-id.important { background: #feebc8; color: #c05621; }
        .test-title { font-size: 16px; font-weight: 600; color: #2d3748; margin: 8px 0; }
        .test-description { color: #718096; font-size: 14px; margin-bottom: 15px; }
        .test-prompt { background: #ebf8ff; padding: 12px; border-radius: 6px; font-size: 13px; color: #2c5282; margin-bottom: 10px; border-left: 3px solid #3182ce; }
        .test-prompt strong { display: block; margin-bottom: 5px; }

        .result-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .result-label { font-weight: 600; color: #4a5568; min-width: 60px; }
        .result-options { display: flex; gap: 8px; }
        .result-btn { padding: 8px 16px; border: 2px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .result-btn:hover { border-color: #3182ce; }
        .result-btn.pass.selected { background: #48bb78; border-color: #48bb78; color: white; }
        .result-btn.partial.selected { background: #ed8936; border-color: #ed8936; color: white; }
        .result-btn.fail.selected { background: #f56565; border-color: #f56565; color: white; }

        .notes-field { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px; resize: vertical; min-height: 60px; }
        .notes-field:focus { outline: none; border-color: #3182ce; }
        .notes-label { font-size: 13px; color: #718096; margin-bottom: 5px; }

        .submit-section { text-align: center; margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0; }
        .submit-btn { background: #3182ce; color: white; border: none; padding: 15px 50px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; }
        .submit-btn:hover { background: #2c5282; }
        .submit-btn:disabled { background: #a0aec0; cursor: not-allowed; }

        .message { padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
        .success { background: #c6f6d5; color: #276749; }
        .error { background: #fed7d7; color: #c53030; }

        .companion-select { margin-bottom: 20px; }
        .companion-select label { display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; }
        .companion-options { display: flex; gap: 10px; }
        .companion-btn { padding: 10px 20px; border: 2px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; font-size: 14px; }
        .companion-btn:hover { border-color: #3182ce; }
        .companion-btn.selected { border-color: #3182ce; background: #ebf8ff; }

        .legend { background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; }
        .legend-item { display: inline-flex; align-items: center; margin-right: 20px; }
        .legend-color { width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; }
        .legend-color.critical { background: #e53e3e; }
        .legend-color.important { background: #ed8936; }

        @media (max-width: 600px) {
            .tester-row { grid-template-columns: 1fr; }
            .result-options { flex-wrap: wrap; }
            .container { padding: 20px; }
            .section-divider { margin: 30px -20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="chapter-badge">Chapter 2</span>
        <h1>Regression Analysis</h1>
        <p class="subtitle">Linear regression, coefficient interpretation, RMSE/MAE, train-test splits</p>

        <div class="legend">
            <span class="legend-item"><span class="legend-color critical"></span> Critical (Must Pass)</span>
            <span class="legend-item"><span class="legend-color important"></span> Important (Should Pass)</span>
        </div>

        <form id="testForm">
            <input type="hidden" name="chapter" value="Chapter 2">

            <div class="tester-section">
                <h3>Tester Information</h3>
                <div class="tester-row">
                    <input type="text" name="testerName" placeholder="Your Name *" required>
                    <input type="email" name="testerEmail" placeholder="Email (optional)">
                    <input type="text" name="testDate" id="testDate" placeholder="Test Date">
                </div>
            </div>

            <input type="hidden" name="companion" value="Reasoning Companion">

            <div class="section-divider">7-Stage Workflow Tests (Example Mode)</div>

            <!-- Test 2.E1 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 2.E1 - IMPORTANT</span>
                    <h3 class="test-title">Stage 1: Business Understanding</h3>
                </div>
                <p class="test-description">Companion should focus on business decision, not mention regression yet.</p>
                <div class="test-prompt">
                    <strong>Setup:</strong> Say "I'm working on Chapter 2 regression example with housing data"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Asks about business decision (pricing? undervalued homes?), focuses on actionability, does NOT mention regression/coefficients/R-squared yet
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2E1" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2E1" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2E1" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2E1" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2E1" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.E3 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 2.E3 - IMPORTANT</span>
                    <h3 class="test-title">Stage 3: Selection Bias Question</h3>
                </div>
                <p class="test-description">Companion should ask "who is NOT in this data?"</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Proceed to Stage 3 (Data Understanding)
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Notes data includes only SOLD houses, asks about unsold listings, discusses how excluded cases might differ
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2E3" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2E3" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2E3" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2E3" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2E3" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.E5 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 2.E5 - CRITICAL</span>
                    <h3 class="test-title">Stage 5: Coefficient Interpretation</h3>
                </div>
                <p class="test-description">Companion MUST state coefficients are associations, not causal effects.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Proceed to Stage 5, view model coefficients
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Uses plain language, uses "otherwise similar houses" framing, EXPLICITLY states "associations, not causal effects", rescales to dollars
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2E5" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2E5" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2E5" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2E5" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2E5" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.E7 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 2.E7 - CRITICAL</span>
                    <h3 class="test-title">Stage 7: Interpretation with Uncertainty</h3>
                </div>
                <p class="test-description">Final summary must include caveats and limitations.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Proceed to Stage 7 (Interpretation)
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Synthesizes findings, states limitations explicitly, asks "what remains unanswered?", asks user to summarize in one cautious sentence
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2E7" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2E7" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2E7" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2E7" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2E7" placeholder="What happened?"></textarea>
            </div>

            <div class="section-divider">Trap Detection Tests</div>

            <!-- Test 2.T1 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 2.T1 - CRITICAL</span>
                    <h3 class="test-title">Coefficient-as-Lever Trap</h3>
                </div>
                <p class="test-description">Companion MUST catch causal interpretations of coefficients.</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Say "The coefficient on RM is 4.8, so adding rooms increases value by $4,800"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Catches causal language ("adding rooms increases"), questions unobserved confounders (lot size, construction quality), does NOT confirm the interpretation
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2T1" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2T1" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2T1" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2T1" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2T1" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.T1b -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 2.T1b - CRITICAL</span>
                    <h3 class="test-title">Coefficient-as-Lever Trap (LSTAT)</h3>
                </div>
                <p class="test-description">Another coefficient trap test with different variable.</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Say "The coefficient on LSTAT is -0.95, so if we reduce LSTAT, prices will go up"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Notes LSTAT is a proxy for neighborhood status, questions unobserved confounders (schools, safety, amenities), does NOT endorse the action
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2T1b" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2T1b" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2T1b" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2T1b" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2T1b" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.T3 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 2.T3 - IMPORTANT</span>
                    <h3 class="test-title">Diagnostics-as-Approval Trap</h3>
                </div>
                <p class="test-description">Companion should not let good R-squared = "reliable model".</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Say "R-squared is 0.74, so the model is reliable"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Does NOT endorse "reliable" conclusion, explains what R-squared does/doesn't tell us, asks about remaining risks
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2T3" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2T3" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2T3" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2T3" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2T3" placeholder="What happened?"></textarea>
            </div>

            <div class="section-divider">Exercise Mode Tests</div>

            <!-- Test 2.X2 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 2.X2</span>
                    <h3 class="test-title">Exercise: Coefficient Interpretation</h3>
                </div>
                <p class="test-description">In exercise mode, companion should question, not confirm.</p>
                <div class="test-prompt">
                    <strong>Setup:</strong> Say "I'm working on Exercise 8.2 - coefficient interpretation"
                </div>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Say "RM coefficient is 4.8, so adding rooms increases value by $4,800"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Socratic response - asks "What are you assuming?", "Could houses with more rooms differ in other ways?", does NOT give direct answer
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2X2" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2X2" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2X2" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2X2" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2X2" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 2.X3 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 2.X3</span>
                    <h3 class="test-title">Exercise: Performance Interpretation</h3>
                </div>
                <p class="test-description">Companion should ask about business context, not declare "good" or "bad".</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Say "MAE is $15,000 and RMSE is $22,000"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Asks about acceptability for business use, asks about train-test gap, does NOT declare whether this is "good"
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_2X3" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_2X3" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_2X3" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_2X3" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_2X3" placeholder="What happened?"></textarea>
            </div>

            <!-- Overall Comments -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">OVERALL</span>
                    <h3 class="test-title">Overall Chapter 2 Assessment</h3>
                </div>
                <div class="notes-label">What worked well?</div>
                <textarea class="notes-field" name="workedWell" placeholder="Describe behaviors that met expectations..."></textarea>
                <br><br>
                <div class="notes-label">What needs improvement?</div>
                <textarea class="notes-field" name="needsImprovement" placeholder="Describe any issues or gaps..."></textarea>
                <br><br>
                <div class="notes-label">Specific bugs or issues:</div>
                <textarea class="notes-field" name="bugs" placeholder="List any specific problems..."></textarea>
            </div>

            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">Submit Chapter 2 Test Results</button>
                <div class="message success" id="successMsg">Test results submitted successfully!</div>
                <div class="message error" id="errorMsg">Error submitting. Please try again.</div>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('testDate').value = new Date().toLocaleDateString();
        document.querySelectorAll('.companion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.companion-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                document.getElementById('companionInput').value = btn.dataset.value;
            });
        });
        document.querySelectorAll('.result-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const field = btn.dataset.field;
                document.querySelectorAll(`[data-field="${field}"]`).forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                document.querySelector(`input[name="${field}"]`).value = btn.dataset.value;
            });
        });
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            const formData = new FormData(e.target);
            const data = { timestamp: new Date().toISOString() };
            formData.forEach((value, key) => { data[key] = value; });
            try {
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbytl4i--uGzcHdE66LEwpAyfVc5FjNWw9v6QzPpP872RBPDlqZsMfbEAdjwAvNDhmBd/exec';
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                document.getElementById('successMsg').style.display = 'block';
                document.getElementById('errorMsg').style.display = 'none';
            } catch (error) {
                document.getElementById('errorMsg').style.display = 'block';
            }
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Chapter 2 Test Results';
        });
    </script>
</body>
</html>
