<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Clustering - Analytics Companion Testing</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
        h1 { color: #1a365d; margin-bottom: 5px; }
        .subtitle { color: #666; margin-bottom: 30px; }
        .chapter-badge { display: inline-block; background: #dd6b20; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 20px; }
        .section-divider { background: #fffaf0; padding: 15px 20px; margin: 30px -40px; font-weight: 600; color: #c05621; font-size: 18px; }

        .tester-section { background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .tester-section h3 { margin-top: 0; color: #2d3748; }
        .tester-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .tester-row input { padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px; }
        .tester-row input:focus { outline: none; border-color: #dd6b20; }

        .test-card { background: #fff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .test-card.critical { border-left: 4px solid #e53e3e; }
        .test-card.important { border-left: 4px solid #ed8936; }
        .test-header { margin-bottom: 15px; }
        .test-id { background: #feebc8; color: #c05621; padding: 3px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .test-id.critical { background: #fed7d7; color: #c53030; }
        .test-id.important { background: #feebc8; color: #c05621; }
        .test-title { font-size: 16px; font-weight: 600; color: #2d3748; margin: 8px 0; }
        .test-description { color: #718096; font-size: 14px; margin-bottom: 15px; }
        .test-prompt { background: #fffaf0; padding: 12px; border-radius: 6px; font-size: 13px; color: #c05621; margin-bottom: 10px; border-left: 3px solid #dd6b20; }
        .test-prompt strong { display: block; margin-bottom: 5px; }

        .result-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .result-label { font-weight: 600; color: #4a5568; min-width: 60px; }
        .result-options { display: flex; gap: 8px; }
        .result-btn { padding: 8px 16px; border: 2px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .result-btn:hover { border-color: #dd6b20; }
        .result-btn.pass.selected { background: #48bb78; border-color: #48bb78; color: white; }
        .result-btn.partial.selected { background: #ed8936; border-color: #ed8936; color: white; }
        .result-btn.fail.selected { background: #f56565; border-color: #f56565; color: white; }

        .notes-field { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px; resize: vertical; min-height: 60px; }
        .notes-field:focus { outline: none; border-color: #dd6b20; }
        .notes-label { font-size: 13px; color: #718096; margin-bottom: 5px; }

        .submit-section { text-align: center; margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0; }
        .submit-btn { background: #dd6b20; color: white; border: none; padding: 15px 50px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; }
        .submit-btn:hover { background: #c05621; }
        .submit-btn:disabled { background: #a0aec0; cursor: not-allowed; }

        .message { padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
        .success { background: #c6f6d5; color: #276749; }
        .error { background: #fed7d7; color: #c53030; }

        .companion-select { margin-bottom: 20px; }
        .companion-select label { display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; }
        .companion-options { display: flex; gap: 10px; }
        .companion-btn { padding: 10px 20px; border: 2px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; font-size: 14px; }
        .companion-btn:hover { border-color: #dd6b20; }
        .companion-btn.selected { border-color: #dd6b20; background: #fffaf0; }

        .legend { background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; }
        .legend-item { display: inline-flex; align-items: center; margin-right: 20px; }
        .legend-color { width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; }
        .legend-color.critical { background: #e53e3e; }
        .legend-color.important { background: #ed8936; }

        @media (max-width: 600px) { .tester-row { grid-template-columns: 1fr; } .result-options { flex-wrap: wrap; } .container { padding: 20px; } .section-divider { margin: 30px -20px; } }
    </style>
</head>
<body>
    <div class="container">
        <span class="chapter-badge">Chapter 4</span>
        <h1>Clustering & Segmentation</h1>
        <p class="subtitle">K-means, feature engineering, scaling, cluster interpretation, segment labeling</p>

        <div class="legend">
            <span class="legend-item"><span class="legend-color critical"></span> Critical (Must Pass)</span>
            <span class="legend-item"><span class="legend-color important"></span> Important (Should Pass)</span>
        </div>

        <form id="testForm">
            <input type="hidden" name="chapter" value="Chapter 4">

            <div class="tester-section">
                <h3>Tester Information</h3>
                <div class="tester-row">
                    <input type="text" name="testerName" placeholder="Your Name *" required>
                    <input type="email" name="testerEmail" placeholder="Email (optional)">
                    <input type="text" name="testDate" id="testDate" placeholder="Test Date">
                </div>
            </div>

            <input type="hidden" name="companion" value="Reasoning Companion">

            <div class="section-divider">7-Stage Workflow Tests (Example Mode)</div>

            <!-- Test 4.E1 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 4.E1</span>
                    <h3 class="test-title">Stage 1: Business Understanding</h3>
                </div>
                <p class="test-description">Companion should focus on why segments matter, not on algorithm.</p>
                <div class="test-prompt">
                    <strong>Setup:</strong> Say "I'm working on Chapter 4 clustering example with airline data"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Asks "Why do we want segments? What decisions will change?", focuses on actionability, does NOT mention K-means or distance yet
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4E1" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4E1" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4E1" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4E1" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4E1" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.E4 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 4.E4 - IMPORTANT</span>
                    <h3 class="test-title">Stage 4: Feature Engineering</h3>
                </div>
                <p class="test-description">Companion should explain RFM features and note assumptions.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Proceed to Stage 4 (Feature Engineering)
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Explains each feature's business meaning (Recency, Frequency, Monetary, Engagement), states assumptions explicitly, notes feature choices affect results
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4E4" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4E4" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4E4" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4E4" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4E4" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.E5 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 4.E5 - CRITICAL</span>
                    <h3 class="test-title">Scaling Explanation</h3>
                </div>
                <p class="test-description">Companion MUST explain why scaling matters for distance-based methods.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Ask about preparing features for clustering
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Explains distance sensitivity to scale, shows how one feature can dominate (e.g., monetary 0-50000 vs recency 0-365), describes standardization, asks if this matches intent
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4E5" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4E5" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4E5" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4E5" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4E5" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.E7 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 4.E7 - CRITICAL</span>
                    <h3 class="test-title">Choosing Number of Clusters (K)</h3>
                </div>
                <p class="test-description">Companion should NOT declare single "correct" K - it's a business decision.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Ask "How many clusters should we use?"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Shows diagnostics (elbow, silhouette) conceptually, does NOT declare single "correct" K, balances data evidence with business practicality, asks "Can you act on this many segments?"
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4E7" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4E7" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4E7" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4E7" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4E7" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.E8 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 4.E8 - IMPORTANT</span>
                    <h3 class="test-title">Cluster Interpretation & Labeling</h3>
                </div>
                <p class="test-description">Companion should use descriptive labels, not judgmental ones.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Proceed to Stage 7 (Interpretation)
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Profiles clusters on features, uses descriptive labels (not "Bad Customers"), connects to actions, notes clusters aren't fixed types
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4E8" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4E8" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4E8" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4E8" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4E8" placeholder="What happened?"></textarea>
            </div>

            <div class="section-divider">Trap Detection Tests</div>

            <!-- Test 4.T1 -->
            <div class="test-card critical">
                <div class="test-header">
                    <span class="test-id critical">TEST 4.T1 - CRITICAL</span>
                    <h3 class="test-title">Reification Trap</h3>
                </div>
                <p class="test-description">Companion MUST catch when user treats clusters as inherent types.</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Say "Cluster 3 ARE our most loyal customers"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Catches essentialist language ("ARE"), notes clusters depend on feature/scaling choices, emphasizes clusters are analytical constructs not inherent types, does NOT endorse "they ARE" framing
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4T1" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4T1" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4T1" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4T1" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4T1" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.T2 -->
            <div class="test-card important">
                <div class="test-header">
                    <span class="test-id important">TEST 4.T2 - IMPORTANT</span>
                    <h3 class="test-title">Feature Blindness Trap</h3>
                </div>
                <p class="test-description">Companion should note clusters reflect feature choices.</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Interpret clusters without considering feature choice
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Notes clusters reflect features chosen, asks what's being emphasized, asks what's being ignored (cabin class, routes, upgrades), connects to interpretation limits
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4T2" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4T2" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4T2" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4T2" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4T2" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.T4 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 4.T4</span>
                    <h3 class="test-title">Metric Worship Trap</h3>
                </div>
                <p class="test-description">Companion should not let elbow/silhouette determine "correct" K.</p>
                <div class="test-prompt">
                    <strong>Trigger:</strong> Say "The elbow says K=4 is correct"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Reframes "correct" as "suggested", asks about business practicality, considers simpler alternatives
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4T4" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4T4" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4T4" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4T4" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4T4" placeholder="What happened?"></textarea>
            </div>

            <div class="section-divider">Exercise Mode Tests</div>

            <!-- Test 4.X3 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 4.X3</span>
                    <h3 class="test-title">Exercise: Choosing K</h3>
                </div>
                <p class="test-description">In exercise mode, companion should question metric-based decisions.</p>
                <div class="test-prompt">
                    <strong>Setup:</strong> Say "I'm working on Exercise 7.4 - choosing number of clusters"
                </div>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Say "Silhouette is highest at K=5, so we should use 5"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Triggers metric worship response, asks about business practicality, questions if 5 segments are actionable
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4X3" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4X3" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4X3" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4X3" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4X3" placeholder="What happened?"></textarea>
            </div>

            <!-- Test 4.X4 -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">TEST 4.X4</span>
                    <h3 class="test-title">Exercise: Naming Segments</h3>
                </div>
                <p class="test-description">Companion should redirect judgmental labels to descriptive ones.</p>
                <div class="test-prompt">
                    <strong>Test Action:</strong> Propose label: "This cluster should be called 'Bad Customers'"
                </div>
                <div class="test-prompt">
                    <strong>Expected:</strong> Catches judgmental language, asks what behavior the label describes, notes labels affect treatment, suggests neutral alternatives ("Low-Activity", "Disengaged")
                </div>
                <div class="result-row">
                    <span class="result-label">Result:</span>
                    <div class="result-options">
                        <button type="button" class="result-btn pass" data-field="test_4X4" data-value="Pass">Pass</button>
                        <button type="button" class="result-btn partial" data-field="test_4X4" data-value="Partial">Partial</button>
                        <button type="button" class="result-btn fail" data-field="test_4X4" data-value="Fail">Fail</button>
                    </div>
                </div>
                <input type="hidden" name="test_4X4" value="">
                <div class="notes-label">Notes:</div>
                <textarea class="notes-field" name="notes_4X4" placeholder="What happened?"></textarea>
            </div>

            <!-- Overall Comments -->
            <div class="test-card">
                <div class="test-header">
                    <span class="test-id">OVERALL</span>
                    <h3 class="test-title">Overall Chapter 4 Assessment</h3>
                </div>
                <div class="notes-label">What worked well?</div>
                <textarea class="notes-field" name="workedWell" placeholder="Describe behaviors that met expectations..."></textarea>
                <br><br>
                <div class="notes-label">What needs improvement?</div>
                <textarea class="notes-field" name="needsImprovement" placeholder="Describe any issues or gaps..."></textarea>
                <br><br>
                <div class="notes-label">Specific bugs or issues:</div>
                <textarea class="notes-field" name="bugs" placeholder="List any specific problems..."></textarea>
            </div>

            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">Submit Chapter 4 Test Results</button>
                <div class="message success" id="successMsg">Test results submitted successfully!</div>
                <div class="message error" id="errorMsg">Error submitting. Please try again.</div>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('testDate').value = new Date().toLocaleDateString();
        document.querySelectorAll('.companion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.companion-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                document.getElementById('companionInput').value = btn.dataset.value;
            });
        });
        document.querySelectorAll('.result-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const field = btn.dataset.field;
                document.querySelectorAll(`[data-field="${field}"]`).forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                document.querySelector(`input[name="${field}"]`).value = btn.dataset.value;
            });
        });
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            const formData = new FormData(e.target);
            const data = { timestamp: new Date().toISOString() };
            formData.forEach((value, key) => { data[key] = value; });
            try {
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbytl4i--uGzcHdE66LEwpAyfVc5FjNWw9v6QzPpP872RBPDlqZsMfbEAdjwAvNDhmBd/exec';
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                document.getElementById('successMsg').style.display = 'block';
                document.getElementById('errorMsg').style.display = 'none';
            } catch (error) {
                document.getElementById('errorMsg').style.display = 'block';
            }
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Chapter 4 Test Results';
        });
    </script>
</body>
</html>
